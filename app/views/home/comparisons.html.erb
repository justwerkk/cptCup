<% content_for :head do %>
<style>
  body {
    font-family: Baskerville, "Times New Roman", serif;
  }
  .svg-container {
  }
</style>
<% end %>

<select id="player-selector">
  <option>bert</option>
  <option>steven</option>
  <option>lijen</option>
  <option>tony</option>
</select>
<svg class="svg-container"></svg>

<% content_for :script do %>
<script src="http://d3js.org/d3.v2.min.js"></script>
<script>
  var w = 400, h = 300;
  var nameGap = 100;
  var namesHash = {1: 'bert', 2: 'lijen', 3: 'steven', 4: 'tony'};
  var data = {bert: [[2,5], [3,2], [4,-3]], steven: [[1,-2],[3,-3],[4,2]], lijen: [[1,-5],[2,3],[4,2]], tony: [[1,3],[2,-2]]};

     // var x = d3.scale.linear()
     // .domain([0, 1])
     // .range([0, w]);
     // var y = d3.scale.linear()
     // .domain([0, 100])
     // .rangeRound([0, h]);

  var chart = d3.select('svg')
    .attr('width', w)
    .attr('height', h);

  $("#player-selector").change(function() {
    drawComparisons(data[$(this).val()]);
  });

  drawComparisons(data['bert']);

  function drawComparisons(dataPoints) {
    dataPoints = dataPoints.sort(function(a, b) {
      return d3.descending(a[1], b[1]);
    });
    var bars = chart.selectAll('rect')
      .data(dataPoints);
    bars.enter().append('rect');
    bars.transition().duration(1000)
      .attr('x', function(d) {
        if (d[1] > 0) {
          return w/2 + nameGap/2;
        } else {
          return w/2 - nameGap/2 + d[1] * 20;
        }
      })
      .attr('fill', function(d) {
        if (d[1] > 0) {
          return "rgb(0, " + (Math.abs(d[1]) * 100) + ", 0)";
        } else {
          return "rgb(" + (Math.abs(d[1]) * 100) + ", 0, 0)";
        }
      })
      .attr('y', function(d, i) { return i * 20; })
      .attr('width', function(d) { return Math.abs(d[1]*20); })
      .attr('height', 15);
    bars.exit().remove();

    var text = chart.selectAll('text')
      .data(dataPoints)
    text.enter().append("text");
    text.transition().duration(1000)
      .attr('x', function(d) { return w/2; })
      .attr('y', function(d, i) { return (i * 20) + 13; })
      .attr("text-anchor", "middle")
      .attr('width', nameGap)
      .text(function(d) {
        return namesHash[d[0]];
      });
    text.exit().remove();

    var winLoss = chart.selectAll('winLossText')
      .data(dataPoints)
    winLoss.enter().append("text");
    winLoss.transition().duration(1000)
      .attr('x', function(d) {
        if (d[1] > 0) {
          return w/2 + nameGap/2 - 10;
        } else {
          return w/2 - nameGap/2 + 10;
        }
      })
      .attr('y', function(d, i) { return (i * 20) + 13; })
      .attr("text-anchor", "middle")
      .attr('width', nameGap)
      .text(function(d) { return (d[1] > 0 ? "+" : "") + d[1]; });
    winLoss.exit().remove();
  }
</script>
<% end %>